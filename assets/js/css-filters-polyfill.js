/*!
 * css-filters-polyfill.js
 *
 * Author: Christian Schepp Schaefer
 * Summary: A polyfill for CSS filter effects
 * License: MIT
 * Version: 0.22
 *
 * URL:
 * https://github.com/Schepp/
 *
 */
;(function(b){var a={_ie:(function(){var e,c=3,f=document.createElement("div"),d=f.getElementsByTagName("i");while(f.innerHTML="<!--[if gt IE "+(++c)+"]><i></i><![endif]-->",d[0]){}return c>4?c:e}()),_svg_cache:{},_create_svg_element:function(e,c){var f="http://www.w3.org/2000/svg";var d=document.createElementNS(f,e);for(key in c){d.setAttributeNS(null,key,c[key])}return d},_create_svg:function(h,e){var g="http://www.w3.org/2000/svg";var c=document.createElementNS(g,"svg");c.setAttributeNS(null,"width","0");c.setAttributeNS(null,"height","0");c.setAttributeNS(null,"style","position:absolute");var f=document.createElementNS(g,"filter");f.setAttributeNS(null,"id",h);c.appendChild(f);for(var d=0;d<e.length;d++){f.appendChild(e[d])}return c},_pending_stylesheets:0,_stylesheets:[],_development_mode:(function(){if(location.hostname==="localhost"||location.hostname.search(/.local$/)!==-1||location.hostname.search(/\d+\.\d+\.\d+\.\d+/)!==-1){if(b.console){console.log("Detected localhost or IP address. Assuming you are a developer. Caching of stylesheets is disabled.")}return true}if(b.console){console.log("Caching of stylesheets is enabled. You need to refresh twice to see any changes.")}return false})(),process_stylesheets:function(){var c=[];b.setTimeout(function(){if(b.XMLHttpRequest){var f=new XMLHttpRequest()}else{if(b.ActiveXObject){var f=new ActiveXObject("Microsoft.XMLHTTP")}}f.open("GET",b.polyfilter_scriptpath+"htc/sepia.htc",true);f.onreadystatechange=function(){if(c.readyState==4&&c.status!=200){alert('The configured path \r\rvar polyfilter_scriptpath = "'+b.polyfilter_scriptpath+'"\r\rseems wrong!\r\rConfigure the polyfill\'s correct absolute(!) script path before referencing the css-filters-polyfill.js, like so:\r\rvar polyfilter_scriptpath = "/js/css-filters-polyfill/";\r\rLeaving IE dead in the water is no option. You damn Mac user... ;)')}};try{f.send(null)}catch(g){}},2000);var e=document.querySelectorAll?document.querySelectorAll('style,link[rel="stylesheet"]'):document.getElementsByTagName("*");for(var d=0;d<e.length;d++){(function(j){switch(e[j].nodeName){default:break;case"STYLE":a._stylesheets.push({media:e[j].media||"all",content:e[j].innerHTML});break;case"LINK":if(e[j].rel==="stylesheet"){var h=a._stylesheets.length;a._stylesheets.push({media:e[j].media||"all"});a._pending_stylesheets++;var g=e[j].href;if(!a._development_mode&&b.localStorage&&b.localStorage.getItem("polyfilter_"+g)){a._pending_stylesheets--;a._stylesheets[h].content=localStorage.getItem("polyfilter_"+g);if(a._pending_stylesheets===0){a.process()}}try{if(b.XMLHttpRequest){var f=new XMLHttpRequest()}else{if(b.ActiveXObject){var f=new ActiveXObject("Microsoft.XMLHTTP")}}f.open("GET",g,true);f.onreadystatechange=function(){if(f.readyState===4){if(f.status===0){if(b.console){console.log("Could not fetch external CSS via HTTP-Request "+g+". Probably because of cross origin.")}if(!a._stylesheets[h].content){a._pending_stylesheets--;a._stylesheets[h].content=f.responseText;if(a._pending_stylesheets===0){a.process()}}}else{if(!a._stylesheets[h].content){a._pending_stylesheets--;a._stylesheets[h].content=f.responseText;if(a._pending_stylesheets===0){a.process()}}if(!a._development_mode&&b.localStorage){try{b.localStorage.setItem("polyfilter_"+g,a._stylesheets[h].content)}catch(i){if(b.console){console.log("Local storage quota have been exceeded. Caching of stylesheet "+g+" is not possible")}}}}}};try{f.send(null)}catch(k){if(b.console){console.log("Could not fetch external CSS via HTTP-Request "+g+". Are you maybe testing using the file://-protocol?")}if(!a._stylesheets[h].content){a._pending_stylesheets--;if(a._pending_stylesheets===0){a.process()}}}}catch(k){}}break}})(d)}if(this._pending_stylesheets===0){this.process()}},_processDeclarations:function(n){var d="";for(var j in n.declarations){var i=n.declarations[j];if(i.property==="filter"){if(document.querySelectorAll){var f=document.querySelectorAll(n.mSelectorText);for(var j=0;j<f.length;j++){f[j].style.polyfilterStore=i.valueText}}var e=i.valueText;var p=e.split(/\)\s+/),m={filtersW3C:[],filtersWebKit:[],filtersSVG:[],filtersIE:[],behaviorsIE:[]};for(idx in p){var o=p[idx]+")";currentproperties=a.convert(o);for(key in currentproperties){if(typeof m[key]!=="undefined"){m[key]=m[key].concat(currentproperties[key])}}}d+=n.mSelectorText+"{";if(m.filtersW3C.length>0){var h=webkitFilter=mozFilter=oFilter=msFilter=m.filtersW3C.join(" ");if(m.filtersWebKit&&m.filtersWebKit.length>0){webkitFilter=m.filtersWebKit.join(" ")}if(typeof this._ie==="undefined"){d+="-ms-filter:"+msFilter+";"}d+="-webkit-filter:"+webkitFilter+";";d+="-moz-filter:"+mozFilter+";";d+="-o-filter:"+oFilter+";"}if(m.filtersSVG.length>0){if(m.filtersSVG[0]!="none"){var g=e.replace(/[^a-z0-9]/g,"");if(typeof this._svg_cache[g]==="undefined"){this._svg_cache[g]=this._create_svg(g,m.filtersSVG);if(typeof XMLSerializer==="undefined"){document.body.appendChild(this._svg_cache[g])}else{var r=new XMLSerializer();var c=r.serializeToString(this._svg_cache[g]);if(c.search("SourceGraphic")!=-1){document.body.appendChild(this._svg_cache[g])}}}if(typeof XMLSerializer==="undefined"){d+="filter: url(#"+g+")"}else{var r=new XMLSerializer();var c=r.serializeToString(this._svg_cache[g]);if(c.search("SourceGraphic")!=-1){d+="filter: url(#"+g+")"}else{d+="filter: url('data:image/svg+xml;utf8,"+c+"#"+g+"')"}}}else{d+="filter: none;"}}if(typeof this._ie!=="undefined"){if(m.filtersIE.length>0){var l=m.filtersIE.join(" ");d+="filter:"+l+";"}if(m.behaviorsIE.length>0){var q=m.behaviorsIE.join(" ");d+="behavior:"+q+";"}}d+="}\r\n"}}return d},scriptpath:b.polyfilter_scriptpath?b.polyfilter_scriptpath:(function(){alert('Please configure the polyfill\'s absolute(!) script path before referencing the css-filters-polyfill.js, like so:\r\nvar polyfilter_scriptpath = "/js/css-filters-polyfill/";');return"./"})(),process:function(){var c=new CSSParser();for(var g=0;g<this._stylesheets.length;g++){var d="";var l=c.parse(this._stylesheets[g].content,false,true);if(l!==null){for(var f in l.cssRules){var m=l.cssRules[f];switch(m.type){default:break;case 1:d+=this._processDeclarations(m);break;case 4:d+="@media "+m.media.join(",")+"{";for(var e in m.cssRules){var h=m.cssRules[e];d+=this._processDeclarations(h)}d+="}";break}}}var n=document.createElement("style");n.setAttribute("media",this._stylesheets[g].media);if(typeof a._ie==="undefined"){n.innerHTML=d;document.getElementsByTagName("head")[0].appendChild(n)}else{document.getElementsByTagName("head")[0].appendChild(n);n.styleSheet.cssText=d}}},init:function(){if(Object.defineProperty){Object.defineProperty(CSSStyleDeclaration.prototype,"polyfilter",{get:function(){return this.polyfilterStore},set:function(e){values=e.split(/\)\s+/);var d={filtersW3C:[],filtersWebKit:[],filtersSVG:[],filtersIE:[],behaviorsIE:[]};for(idx in values){var g=values[idx]+")";currentproperties=a.convert(g);for(key in currentproperties){if(typeof d[key]!=="undefined"){d[key]=d[key].concat(currentproperties[key])}}}if(d.filtersW3C.length>0){if(typeof a._ie==="undefined"){this.msFilter=d.filtersW3C.join(" ")}this.webkitFilter=this.mozFilter=this.oFilter=d.filtersW3C.join(" ")}if(d.filtersWebKit.length>0){this.webkitFilter=d.filtersWebKit.join(" ")}if(d.filtersSVG.length>0){if(d.filtersSVG[0]!="none"){var h=e.replace(/[^a-z0-9]/g,"");if(typeof a._svg_cache[h]==="undefined"){a._svg_cache[h]=a._create_svg(h,d.filtersSVG);if(typeof XMLSerializer==="undefined"){document.body.appendChild(a._svg_cache[h])}else{var f=new XMLSerializer();var c=f.serializeToString(a._svg_cache[h]);if(c.search("SourceGraphic")!=-1){document.body.appendChild(a._svg_cache[h])}}}if(typeof XMLSerializer==="undefined"){this.filter="url(#"+h+")"}else{var f=new XMLSerializer();var c=f.serializeToString(a._svg_cache[h]);if(c.search("SourceGraphic")!=-1){this.filter="url(#"+h+")"}else{this.filter="url('data:image/svg+xml;utf8,"+c+"#"+h+"')"}}}else{this.filter="none"}}if(typeof a._ie!=="undefined"){if(d.filtersIE.length>0){this.filter=d.filtersIE.join(" ")}else{this.filter=""}if(d.behaviorsIE.length>0){this.behavior=d.behaviorsIE.join(" ")}else{this.behavior=""}}this.polyfilterStore=e}})}},convert:function(i){var f=i.match(/none/i);if(f!==null){var h=this.filters.none()}var f=i.match(/(grayscale)\(([0-9\.]+)\)/i);if(f!==null){var g=parseFloat(f[2],10),h=this.filters.grayscale(g)}var f=i.match(/(sepia)\(([0-9\.]+)\)/i);if(f!==null){var g=parseFloat(f[2],10),h=this.filters.sepia(g)}var f=i.match(/(blur)\(([0-9]+)[px]*\)/i);if(f!==null){var g=parseInt(f[2],10),h=this.filters.blur(g)}var f=i.match(/(invert)\(([0-9\.]+)\)/i);if(f!==null){var g=parseFloat(f[2],10),h=this.filters.invert(g)}var f=i.match(/(brightness)\(([0-9\.]+)%\)/i);if(f!==null){var g=parseFloat(f[2],10),h=this.filters.brightness(g)}var f=i.match(/(drop\-shadow)\(([0-9]+)[px]*\s+([0-9]+)[px]*\s+([0-9]+)[px]*\s+([#0-9]+)\)/i);if(f!==null){var d=parseInt(f[2],10),j=parseInt(f[3],10),c=parseInt(f[4],10),e=f[5],h=this.filters.dropShadow(d,j,c,e)}return h},filters:{none:function(){var c={};if(typeof a._ie==="undefined"){c.filtersW3C=["none"];c.filtersSVG=["none"]}else{c.filtersIE=["none"]}return c},grayscale:function(e){e=e||0;var d={};if(typeof a._ie==="undefined"){d.filtersW3C=["grayscale("+e+")"];var c=a._create_svg_element("feColorMatrix",{type:"matrix",values:(0.2126+0.7874*(1-e))+" "+(0.7152-0.7152*(1-e))+" "+(0.0722-0.0722*(1-e))+" 0 0 "+(0.2126-0.2126*(1-e))+" "+(0.7152+0.2848*(1-e))+" "+(0.0722-0.0722*(1-e))+" 0 0 "+(0.2126-0.2126*(1-e))+" "+(0.7152-0.7152*(1-e))+" "+(0.0722+0.9278*(1-e))+" 0 0 0 0 0 1 0"});d.filtersSVG=[c]}else{d.filtersIE=e>=0.5?["gray"]:[]}return d},sepia:function(e){e=e||0;var d={};if(typeof a._ie==="undefined"){d.filtersW3C=["sepia("+e+")"];var c=a._create_svg_element("feColorMatrix",{type:"matrix",values:(0.393+0.607*(1-e))+" "+(0.769-0.769*(1-e))+" "+(0.189-0.189*(1-e))+" 0 0 "+(0.349-0.349*(1-e))+" "+(0.686+0.314*(1-e))+" "+(0.168-0.168*(1-e))+" 0 0 "+(0.272-0.272*(1-e))+" "+(0.534-0.534*(1-e))+" "+(0.131+0.869*(1-e))+" 0 0 0 0 0 1 0"});d.filtersSVG=[c]}else{d.filtersIE=e>=0.5?["gray","progid:DXImageTransform.Microsoft.Light()"]:[];d.behaviorsIE=e>=0.5?['url("'+a.scriptpath+'htc/sepia.htc")']:[]}return d},blur:function(e){e=Math.round(e)||0;var d={};if(typeof a._ie==="undefined"){d.filtersW3C=["blur("+e+"px)"];var c=a._create_svg_element("feGaussianBlur",{"in":"SourceGraphic",stdDeviation:e});d.filtersSVG=[c]}else{d.filtersIE=["progid:DXImageTransform.Microsoft.Blur(pixelradius="+e+")"]}return d},invert:function(f){f=f||0;var e={};if(typeof a._ie==="undefined"){e.filtersW3C=["invert("+f+")"];var c=a._create_svg_element("feComponentTransfer",{});var d=a._create_svg_element("feFuncR",{type:"table",tableValues:f+" "+(1-f)});c.appendChild(d);var d=a._create_svg_element("feFuncG",{type:"table",tableValues:f+" "+(1-f)});c.appendChild(d);var d=a._create_svg_element("feFuncB",{type:"table",tableValues:f+" "+(1-f)});c.appendChild(d);e.filtersSVG=[c]}else{e.filtersIE=f>=0.5?["invert"]:[]}return e},brightness:function(f){f=f||0;var e={};if(typeof a._ie==="undefined"){e.filtersW3C=["brightness("+f+"%)"];e.filtersWebKit=["brightness("+(f-100)+"%)"];var c=a._create_svg_element("feComponentTransfer",{});var d=a._create_svg_element("feFuncR",{type:"linear",slope:f/100});c.appendChild(d);var d=a._create_svg_element("feFuncG",{type:"linear",slope:f/100});c.appendChild(d);var d=a._create_svg_element("feFuncB",{type:"linear",slope:f/100});c.appendChild(d);e.filtersSVG=[c]}else{e.filtersIE=["progid:DXImageTransform.Microsoft.Light()"];e.behaviorsIE=['url("'+a.scriptpath+'htc/brightness.htc")']}return e},dropShadow:function(f,e,g,d){f=Math.round(f)||0;e=Math.round(e)||0;g=Math.round(g)||0;d=d||"#000000";var h={};if(typeof a._ie==="undefined"){h.filtersW3C=["drop-shadow("+f+"px "+e+"px "+g+"px "+d+")"];var m=a._create_svg_element("feGaussianBlur",{"in":"SourceAlpha",stdDeviation:g});var l=a._create_svg_element("feOffset",{dx:f+1,dy:e+1,result:"offsetblur"});var k=a._create_svg_element("feFlood",{"flood-color":d});var j=a._create_svg_element("feComposite",{in2:"offsetblur",operator:"in"});var i=a._create_svg_element("feMerge",{});var c=a._create_svg_element("feMergeNode",{});i.appendChild(c);var c=a._create_svg_element("feMergeNode",{"in":"SourceGraphic"});i.appendChild(c);h.filtersSVG=[m,l,k,j,i]}else{h.filtersIE=["progid:DXImageTransform.Microsoft.Glow(color="+d+",strength=0)","progid:DXImageTransform.Microsoft.Shadow(color="+d+",strength=0)"];h.behaviorsIE=['url("'+a.scriptpath+'htc/drop-shadow.htc")']}return h}}};if(b.jQuery){b.jQuery(document).ready(function(c){a.process_stylesheets()})}else{if(b.contentLoaded){contentLoaded(b,function(){a.process_stylesheets()})}else{if(b.addEventListener){document.addEventListener("DOMContentLoaded",function(){a.process_stylesheets()},false)}else{if(b.attachEvent){b.attachEvent("onload",function(){a.process_stylesheets()})}}}}a.init()})(window);