(function(a){a.fn.lightbox=function(h){var r=a.extend({},a.fn.lightbox.defaults,h);a(window).resize(v);return a(this).on(r.triggerEvent,function(){e();q(this);return false});function e(){a("#overlay, #lightbox").remove();r.inprogress=false;if(r.jsonData&&r.jsonData.length>0){var z=r.jsonDataParser?r.jsonDataParser:a.fn.lightbox.parseJsonData;r.imageArray=[];r.imageArray=z(r.jsonData)}var w='<div id="outerImageContainer"><div id="imageContainer"><iframe id="lightboxIframe"></iframe><img id="lightboxImage" /><div id="hoverNav"><a href="javascript://" title="'+r.strings.prevLinkTitle+'" id="prevLink"></a><a href="javascript://" id="nextLink" title="'+r.strings.nextLinkTitle+'"></a></div><div id="loading"><a href="javascript://" id="loadingLink"><img src="'+r.fileLoadingImage+'"></a></div></div></div>';var y='<div id="imageDataContainer" class="clearfix"><div id="imageData"><div id="imageDetails"><span id="caption"></span><span id="numberDisplay"></span></div><div id="bottomNav">';if(r.displayHelp){y+='<span id="helpDisplay">'+r.strings.help+"</span>"}y+='<a href="javascript://" id="bottomNavClose" title="'+r.strings.closeTitle+'"><img src="'+r.fileBottomNavCloseImage+'"></a></div></div></div>';var x;if(r.navbarOnTop){x='<div id="overlay"></div><div id="lightbox">'+y+w+"</div>";a("body").append(x);a("#imageDataContainer").addClass("ontop")}else{x='<div id="overlay"></div><div id="lightbox">'+w+y+"</div>";a("body").append(x)}if(r.imageScroll===true){a("#lightbox").css("position","fixed")}a("#overlay, #lightbox").click(function(){l()}).hide();a("#loadingLink, #bottomNavClose").click(function(){l();return false});a("#outerImageContainer").width(r.widthCurrent).height(r.heightCurrent);a("#imageDataContainer").width(r.widthCurrent);if(!r.imageClickClose){a("#lightboxImage").click(function(){return false});a("#hoverNav").click(function(){return false})}return true}function t(){var w=new Array(a(document).width(),a(document).height(),a(window).width(),a(window).height());return w}function g(){var y,w;if(self.pageYOffset){w=self.pageYOffset;y=self.pageXOffset}else{if(document.documentElement&&(document.documentElement.scrollTop||document.documentElement.scrollLeft)){w=document.documentElement.scrollTop;y=document.documentElement.scrollLeft}else{if(document.body){w=document.body.scrollTop;y=document.body.scrollLeft}}}var x=new Array(y,w);return x}function q(x){a("select, embed, object").hide();v();a("#overlay").hide().css({opacity:r.overlayOpacity}).fadeIn();imageNum=0;if(!r.jsonData){r.imageArray=[];if((!u(x)||(u(x)==""))&&!r.allSet){r.imageArray.push(new Array(x.href,r.displayTitle?x.title:""))}else{a("a").each(function(){if(this.href&&(u(this)==u(x))){r.imageArray.push(new Array(this.href,r.displayTitle?this.title:""))}})}}if(r.imageArray.length>1){for(i=0;i<r.imageArray.length;i++){for(j=r.imageArray.length-1;j>i;j--){if(r.imageArray[i][0]==r.imageArray[j][0]){r.imageArray.splice(j,1)}}}while(r.imageArray[imageNum][0]!=x.href){imageNum++}}var w=g();var z=w[1]+(a(window).height()/10);var y=w[0];a("#lightbox").css({top:z+"px",left:y+"px"}).show();if(!r.slideNavBar){a("#imageData").hide()}s(imageNum)}function s(w){if(r.inprogress==false){r.inprogress=true;r.activeImage=w;a("#loading").show();a("#lightboxImage, #hoverNav, #prevLink, #nextLink").hide();if(r.slideNavBar){a("#imageDataContainer").hide();a("#imageData").hide()}k()}}function k(){var w=new Image();w.onload=function(){var C=w.width;var x=w.height;if(r.scaleImages){C=parseInt(r.xScale*C);x=parseInt(r.yScale*x)}if(r.fitToScreen){var z=t();var B;var y=z[2]-2*r.borderSize;var D=z[3]-200;var A=y/D;var E=w.width/w.height;if((w.height>D)||(w.width>y)){if(A>E){C=parseInt((D/w.height)*w.width);x=D}else{x=parseInt((y/w.width)*w.height);C=y}}}a("#lightboxImage").attr("src",r.imageArray[r.activeImage][0]).width(C).height(x);m(C,x)};w.src=r.imageArray[r.activeImage][0]}function l(){n();a("#lightbox").hide();a("#overlay").fadeOut();a("select, object, embed").show()}function f(){var x,w;if(r.loopImages&&r.imageArray.length>1){w=new Image();w.src=r.imageArray[(r.activeImage==(r.imageArray.length-1))?0:r.activeImage+1][0];x=new Image();x.src=r.imageArray[(r.activeImage==0)?(r.imageArray.length-1):r.activeImage-1][0]}else{if((r.imageArray.length-1)>r.activeImage){w=new Image();w.src=r.imageArray[r.activeImage+1][0]}if(r.activeImage>0){x=new Image();x.src=r.imageArray[r.activeImage-1][0]}}}function m(z,x){r.widthCurrent=a("#outerImageContainer").outerWidth();r.heightCurrent=a("#outerImageContainer").outerHeight();var w=Math.max(350,z+(r.borderSize*2));var y=(x+(r.borderSize*2));wDiff=r.widthCurrent-w;hDiff=r.heightCurrent-y;a("#imageDataContainer").animate({width:w},r.resizeSpeed,"linear");a("#outerImageContainer").animate({width:w},r.resizeSpeed,"linear",function(){a("#outerImageContainer").animate({height:y},r.resizeSpeed,"linear",function(){d()})});afterTimeout=function(){a("#prevLink").height(x);a("#nextLink").height(x)};if((hDiff==0)&&(wDiff==0)){setTimeout(afterTimeout,100)}else{afterTimeout()}}function d(){a("#loading").hide();a("#lightboxImage").fadeIn("fast");c();f();r.inprogress=false}function c(){a("#numberDisplay").html("");if(r.imageArray[r.activeImage][1]){a("#caption").html(r.imageArray[r.activeImage][1]).show()}if(r.imageArray.length>1){var w;w=r.strings.image+(r.activeImage+1)+r.strings.of+r.imageArray.length;if(r.displayDownloadLink){w+="<a href='"+r.imageArray[r.activeImage][0]+"'>"+r.strings.download+"</a>"}if(!r.disableNavbarLinks){if((r.activeImage)>0||r.loopImages){w='<a title="'+r.strings.prevLinkTitle+'" href="#" id="prevLinkText">'+r.strings.prevLinkText+"</a>"+w}if(((r.activeImage+1)<r.imageArray.length)||r.loopImages){w+='<a title="'+r.strings.nextLinkTitle+'" href="#" id="nextLinkText">'+r.strings.nextLinkText+"</a>"}}a("#numberDisplay").html(w).show()}if(r.slideNavBar){a("#imageData").slideDown(r.navBarSlideSpeed)}else{a("#imageData").show()}v();o()}function v(){a("#overlay").css({width:a(document).width(),height:a(document).height()})}function o(){if(r.imageArray.length>1){a("#hoverNav").show();if(r.loopImages){a("#prevLink,#prevLinkText").show().click(function(){s((r.activeImage==0)?(r.imageArray.length-1):r.activeImage-1);return false});a("#nextLink,#nextLinkText").show().click(function(){s((r.activeImage==(r.imageArray.length-1))?0:r.activeImage+1);return false})}else{if(r.activeImage!=0){a("#prevLink,#prevLinkText").show().click(function(){s(r.activeImage-1);return false})}if(r.activeImage!=(r.imageArray.length-1)){a("#nextLink,#nextLinkText").show().click(function(){s(r.activeImage+1);return false})}}}b()}function p(z){var A=z.data.opts;var w=z.keyCode;var x=27;var y=String.fromCharCode(w).toLowerCase();if((y=="x")||(y=="o")||(y=="c")||(w==x)){l()}else{if((y=="p")||(w==37)){if(A.loopImages){n();s((A.activeImage==0)?(A.imageArray.length-1):A.activeImage-1)}else{if(A.activeImage!=0){n();s(A.activeImage-1)}}}else{if((y=="n")||(w==39)){if(r.loopImages){n();s((A.activeImage==(A.imageArray.length-1))?0:A.activeImage+1)}else{if(A.activeImage!=(A.imageArray.length-1)){n();s(A.activeImage+1)}}}}}}function b(){a(document).bind("keydown",{opts:r},p)}function n(){a(document).unbind("keydown")}function u(w){var x=w.rel;if(!x||x==""){x=a(w).attr("data-lightbox-set")}return x}};a.fn.lightbox.parseJsonData=function(c){var b=[];a.each(c,function(){b.push(new Array(this.url,this.title))});return b};a.fn.lightbox.defaults={triggerEvent:"click",allSet:false,fileLoadingImage:pluginSetting.loadingImageSrc,fileBottomNavCloseImage:pluginSetting.closeImageSrc,overlayOpacity:0.6,borderSize:10,imageArray:new Array,activeImage:null,imageScroll:false,inprogress:false,resizeSpeed:350,widthCurrent:250,heightCurrent:250,scaleImages:false,xScale:1,yScale:1,displayTitle:true,navbarOnTop:false,displayDownloadLink:false,slideNavBar:false,navBarSlideSpeed:350,displayHelp:false,strings:{help:" \u2190 / P - previous image\u00a0\u00a0\u00a0\u00a0\u2192 / N - next image\u00a0\u00a0\u00a0\u00a0ESC / X - close image gallery",prevLinkTitle:"previous image",nextLinkTitle:"next image",prevLinkText:"&laquo; Previous",nextLinkText:"Next &raquo;",closeTitle:"close image gallery",image:"Image ",of:" of ",download:"Download"},fitToScreen:false,disableNavbarLinks:false,loopImages:false,imageClickClose:true,jsonData:null,jsonDataParser:null}})(jQuery);